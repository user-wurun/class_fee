(()=>{var e={};e.id=58,e.ids=[58],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},94039:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>c,routeModule:()=>x,tree:()=>d}),r(95593),r(54403),r(90996);var s=r(30170),a=r(45002),o=r(83876),n=r.n(o),l=r(66299),i={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>l[e]);r.d(t,i);let d=["",{children:["applications",{children:["new",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,95593)),"C:\\Users\\Wu\\Desktop\\班费管理系统\\app\\applications\\new\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,54403)),"C:\\Users\\Wu\\Desktop\\班费管理系统\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,90996,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\Wu\\Desktop\\班费管理系统\\app\\applications\\new\\page.tsx"],m="/applications/new/page",u={require:r,loadChunk:()=>Promise.resolve()},x=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/applications/new/page",pathname:"/applications/new",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},23467:(e,t,r)=>{Promise.resolve().then(r.bind(r,60589))},86328:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,63642,23)),Promise.resolve().then(r.t.bind(r,87586,23)),Promise.resolve().then(r.t.bind(r,47838,23)),Promise.resolve().then(r.t.bind(r,58057,23)),Promise.resolve().then(r.t.bind(r,77741,23)),Promise.resolve().then(r.t.bind(r,13118,23))},93847:(e,t,r)=>{Promise.resolve().then(r.bind(r,72411))},60589:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var s=r(97247),a=r(28964),o=r(34178),n=r(83462),l=r(72411);function i(){let e=(0,o.useRouter)(),[t,r]=(0,a.useState)([]),[i,d]=(0,a.useState)(!1),[c,m]=(0,a.useState)({title:"",type:"expense",amount:"",description:"",categoryId:"",expenseTime:"",source:"",reason:"",customCategory:""}),[u,x]=(0,a.useState)([]),p=e=>{let{name:t,value:r,type:s}=e.target;m(e=>({...e,[t]:"number"===s?""===r?"":Number(r):r}))},h=e=>{x(t=>t.filter((t,r)=>r!==e))},g=async()=>{let e=[];for(let t of u){let r=new FormData;r.append("file",t);try{let t=localStorage.getItem("auth-token"),s=await fetch("/api/upload",{method:"POST",headers:{Authorization:`Bearer ${t}`},body:r}),a=await s.json();a.success&&e.push({url:a.data.url,name:a.data.name,size:a.data.size})}catch(e){l.Am.error(`上传文件 ${t.name} 失败`)}}return e},b=async t=>{t.preventDefault(),d(!0);try{if(!c.title||!c.amount||!c.description){l.Am.error("请填写必填字段"),d(!1);return}if("expense"===c.type&&!c.expenseTime){l.Am.error("支出申请必须填写支出时间"),d(!1);return}if("expense"===c.type&&!c.reason){l.Am.error("支出申请必须填写支出原因"),d(!1);return}if("income"===c.type&&(!c.source||!c.reason)){l.Am.error("收入申请必须填写来源和原因"),d(!1);return}if("expense"===c.type&&0===u.length){l.Am.error("支出申请必须上传至少1张凭证图片"),d(!1);return}if(u.length>5){l.Am.error("最多只能上传5张凭证图片"),d(!1);return}let t=c.categoryId;if("expense"===c.type&&c.customCategory&&c.customCategory.trim())try{let e=localStorage.getItem("auth-token"),r=await fetch("/api/admin/categories",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({name:c.customCategory.trim(),description:"用户自定义分类"})}),s=await r.json();s.success&&(t=s.data.id.toString(),l.Am.success(`已创建新分类: ${c.customCategory.trim()}`))}catch(e){l.Am.error("创建自定义分类失败"),d(!1);return}let r=[];u.length>0&&(r=await g());let s={title:c.title,type:c.type,amount:Number(c.amount),description:c.description,categoryId:t?Number(t):void 0,expenseTime:c.expenseTime||void 0,source:c.source||void 0,reason:c.reason||void 0,proofImages:r},a=localStorage.getItem("auth-token"),o=await fetch("/api/applications",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(s)}),n=await o.json();n.success?(l.Am.success("申请提交成功"),e.push("/")):l.Am.error(n.message)}catch(e){l.Am.error("提交申请失败")}finally{d(!1)}};return s.jsx(n.Z,{children:s.jsx("div",{className:"max-w-2xl mx-auto py-6 px-4 sm:px-0",children:(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"新建申请"}),(0,s.jsxs)("form",{onSubmit:b,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"标题 *"}),s.jsx("input",{type:"text",id:"title",name:"title",value:c.title,onChange:p,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"请输入申请标题",required:!0})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"type",className:"block text-sm font-medium text-gray-700",children:"类型 *"}),(0,s.jsxs)("select",{id:"type",name:"type",value:c.type,onChange:p,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0,children:[s.jsx("option",{value:"expense",children:"支出"}),s.jsx("option",{value:"income",children:"收入"})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700",children:"金额 (元) *"}),s.jsx("input",{type:"number",id:"amount",name:"amount",value:c.amount,onChange:p,step:"0.01",min:"0",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"请输入金额",required:!0})]}),"expense"===c.type&&(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"expenseTime",className:"block text-sm font-medium text-gray-700",children:"支出时间 *"}),s.jsx("input",{type:"datetime-local",id:"expenseTime",name:"expenseTime",value:c.expenseTime,onChange:p,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]})]}),"expense"===c.type&&(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"categoryId",className:"block text-sm font-medium text-gray-700",children:"支出分类"}),(0,s.jsxs)("div",{className:"mt-1 flex space-x-2",children:[(0,s.jsxs)("select",{id:"categoryId",name:"categoryId",value:c.categoryId,onChange:p,className:"flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"选择现有分类"}),t.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),s.jsx("input",{type:"text",name:"customCategory",value:c.customCategory,onChange:p,placeholder:"或输入新分类",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]})]}),"income"===c.type&&(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"source",className:"block text-sm font-medium text-gray-700",children:"收入来源 *"}),s.jsx("input",{type:"text",id:"source",name:"source",value:c.source,onChange:p,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"请输入收入来源",required:!0})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"描述 *"}),s.jsx("textarea",{id:"description",name:"description",value:c.description,onChange:p,rows:3,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"请输入详细描述",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{htmlFor:"reason",className:"block text-sm font-medium text-gray-700",children:["income"===c.type?"收入原因":"支出原因"," *"]}),s.jsx("textarea",{id:"reason",name:"reason",value:c.reason,onChange:p,rows:3,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"请输入具体原因",required:!0})]}),"expense"===c.type&&(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"凭证图片 * (支出申请必须上传1-5张)"}),(0,s.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6",children:[(0,s.jsxs)("div",{className:"text-center",children:[s.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:s.jsx("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),s.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:e=>{let t=Array.from(e.target.files||[]);x(e=>{let r=[...e,...t];return r.length>5?(l.Am.error("最多只能上传5张凭证图片"),e.slice(0,5)):r})},className:"hidden",id:"file-upload"}),s.jsx("label",{htmlFor:"file-upload",className:"cursor-pointer font-medium text-blue-600 hover:text-blue-500",children:"点击上传图片"}),s.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"PNG, JPG, GIF up to 10MB each (最多5张，支出申请至少1张)"})]}),u.length>0&&(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-600 mb-2",children:["已选择 ",u.length,"/5 张图片","expense"===c.type&&0===u.length&&s.jsx("span",{className:"text-red-600 ml-2",children:"（支出申请必须上传至少1张）"})]}),s.jsx("div",{className:"space-y-2",children:u.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between bg-gray-50 p-2 rounded",children:[s.jsx("span",{className:"text-sm text-gray-700 truncate flex-1",children:e.name}),s.jsx("button",{type:"button",onClick:()=>h(t),className:"ml-2 text-red-600 hover:text-red-800",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},t))})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3",children:[s.jsx("button",{type:"button",onClick:()=>e.push("/"),className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"取消"}),s.jsx("button",{type:"submit",disabled:i,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:i?"提交中...":"提交申请"})]})]})]})})})}},83462:(e,t,r)=>{"use strict";r.d(t,{Z:()=>l});var s=r(97247),a=r(28964),o=r(34178),n=r(72411);function l({children:e}){let[t,r]=(0,a.useState)(null),[l,i]=(0,a.useState)(!1),d=(0,o.useRouter)();return t?(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("nav",{className:"bg-white shadow-md",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between h-16",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[s.jsx("button",{onClick:()=>d.push("/"),className:"text-xl font-bold text-gray-800 hover:text-gray-600",children:"班费管理系统"}),s.jsx("a",{href:"https://dashboard.pay.cubestudio.top",target:"_blank",rel:"noopener noreferrer",className:"ml-6 text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:"数据看板"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:["admin"===t.role&&s.jsx("button",{onClick:()=>d.push("/admin"),className:"text-gray-700 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:"管理后台"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("button",{onClick:()=>i(!l),className:"flex items-center text-gray-700 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:[s.jsx("span",{className:"mr-2",children:t.real_name}),s.jsx("span",{className:`text-xs px-2 py-1 rounded ${"admin"===t.role?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:"admin"===t.role?"管理员":"普通用户"}),s.jsx("svg",{className:"ml-2 h-4 w-4",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),l&&(0,s.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50",children:[s.jsx("button",{onClick:()=>{i(!1),(0,n.Am)("个人资料功能开发中")},className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left",children:"个人资料"}),s.jsx("button",{onClick:()=>{i(!1),d.push("/applications/new")},className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left",children:"新建申请"}),s.jsx("hr",{className:"my-1"}),s.jsx("button",{onClick:()=>{localStorage.removeItem("auth-token"),localStorage.removeItem("user"),n.Am.success("已退出登录"),d.push("/login")},className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left",children:"退出登录"})]})]})]})]})})}),s.jsx("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:e})]}):s.jsx("div",{children:"Loading..."})}},34178:(e,t,r)=>{"use strict";var s=r(25289);r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})},95593:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(45347).createProxy)(String.raw`C:\Users\Wu\Desktop\班费管理系统\app\applications\new\page.tsx#default`)},54403:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i,metadata:()=>l});var s=r(72051),a=r(23750),o=r.n(a);r(67272);var n=r(10247);let l={title:"班费管理系统",description:"一个现代化的班级财务管理平台"};function i({children:e}){return s.jsx("html",{lang:"zh-CN",children:(0,s.jsxs)("body",{className:o().className,children:[e,s.jsx(n.x7,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff"},success:{duration:3e3,iconTheme:{primary:"#10b981",secondary:"#fff"}},error:{duration:5e3,iconTheme:{primary:"#ef4444",secondary:"#fff"}}}})]})})}},67272:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[787,527],()=>r(94039));module.exports=s})();