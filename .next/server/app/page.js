(()=>{var e={};e.id=931,e.ids=[931],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},43847:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>d,routeModule:()=>u,tree:()=>c}),s(48646),s(54403),s(90996);var a=s(30170),r=s(45002),l=s(83876),n=s.n(l),i=s(66299),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);s.d(t,o);let c=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,48646)),"C:\\Users\\Wu\\Desktop\\班费管理系统\\app\\page.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,54403)),"C:\\Users\\Wu\\Desktop\\班费管理系统\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,90996,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Users\\Wu\\Desktop\\班费管理系统\\app\\page.tsx"],x="/page",m={require:s,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},87567:(e,t,s)=>{Promise.resolve().then(s.bind(s,77878))},86328:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,63642,23)),Promise.resolve().then(s.t.bind(s,87586,23)),Promise.resolve().then(s.t.bind(s,47838,23)),Promise.resolve().then(s.t.bind(s,58057,23)),Promise.resolve().then(s.t.bind(s,77741,23)),Promise.resolve().then(s.t.bind(s,13118,23))},93847:(e,t,s)=>{Promise.resolve().then(s.bind(s,72411))},77878:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var a=s(97247),r=s(28964),l=s(83462);function n({statistics:e}){let t=e=>new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(e),s=[{title:"当前余额",value:e?t(e.total_balance):"\xa50.00",bgColor:"bg-blue-500",textColor:"text-white"},{title:"总收入",value:e?t(e.total_income):"\xa50.00",bgColor:"bg-green-500",textColor:"text-white"},{title:"总支出",value:e?t(e.total_expense):"\xa50.00",bgColor:"bg-red-500",textColor:"text-white"},{title:"交易笔数",value:e?e.total_transactions:0,bgColor:"bg-purple-500",textColor:"text-white"}];return a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:s.map((e,t)=>(0,a.jsxs)("div",{className:`${e.bgColor} ${e.textColor} p-6 rounded-lg shadow-lg`,children:[a.jsx("div",{className:"text-sm opacity-90 mb-2",children:e.title}),a.jsx("div",{className:"text-2xl font-bold",children:e.value})]},t))})}var i=s(72411);function o({application:e,isOpen:t,onClose:s,onUpdate:l}){let n;let[o,c]=(0,r.useState)(null),[d,x]=(0,r.useState)(!1),[m,u]=(0,r.useState)(null),[p,h]=(0,r.useState)(null),g=e=>new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),b=async()=>{try{let t=localStorage.getItem("auth-token"),a=await fetch(`/api/applications/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({status:"approved"})}),r=await a.json();r.success?(i.Am.success("申请已批准"),l(),s()):i.Am.error(r.message)}catch(e){i.Am.error("操作失败")}},y=async t=>{try{let a=localStorage.getItem("auth-token"),r=await fetch(`/api/applications/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({status:"rejected",rejection_reason:t})}),n=await r.json();n.success?(i.Am.success("申请已拒绝"),l(),s()):i.Am.error(n.message)}catch(e){i.Am.error("操作失败")}},j=async t=>{try{let a=localStorage.getItem("auth-token"),r=await fetch(`/api/applications/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({status:"cancelled",cancellation_reason:t})}),n=await r.json();n.success?(i.Am.success("申请已撤销"),l(),s()):i.Am.error(n.message)}catch(e){i.Am.error("操作失败")}},f=e=>{h(e)};if(!t)return null;let v=o||e;return(0,a.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:[a.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"申请详情"}),a.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:a.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),d?a.jsx("div",{className:"flex justify-center py-8",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"类型"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900",children:a.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${"income"===v.type?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:"income"===v.type?"收入":"支出"})})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"状态"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900",children:a.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${(e=>{switch(e){case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"cancelled":return"bg-gray-100 text-gray-800";default:return"bg-yellow-100 text-yellow-800"}})(v.status)}`,children:(e=>{switch(e){case"approved":return"已通过";case"rejected":return"已拒绝";case"cancelled":return"已撤销";default:return"待审批"}})(v.status)})})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"标题"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900",children:v.title})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"金额"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900 font-medium",children:(n=v.amount,new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(n))})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"申请人"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900",children:v.applicant_name})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"分类"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900",children:v.category_name||"-"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"申请时间"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900",children:g(v.created_at)})]}),v.expense_time&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"支出时间"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900",children:g(v.expense_time)})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"描述"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900",children:v.description})]}),"income"===v.type&&v.source&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"收入来源"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900",children:v.source})]}),v.reason&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"income"===v.type?"收入原因":"支出原因"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900",children:v.reason})]}),v.rejection_reason&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"拒绝原因"}),a.jsx("p",{className:"mt-1 text-sm text-red-600",children:v.rejection_reason})]}),v.cancellation_reason&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"撤销原因"}),a.jsx("p",{className:"mt-1 text-sm text-gray-600",children:v.cancellation_reason})]}),v.proof_images&&v.proof_images.length>0&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"凭证图片"}),a.jsx("div",{className:"grid grid-cols-2 gap-4",children:v.proof_images.map(e=>(0,a.jsxs)("div",{className:"relative group cursor-pointer",onClick:()=>f(e.image_url),children:[a.jsx("img",{src:e.image_url,alt:e.image_name,className:"w-full h-48 object-cover rounded-lg"}),a.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition duration-200 rounded-lg flex items-center justify-center",children:a.jsx("svg",{className:"w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition duration-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"})})}),a.jsx("p",{className:"mt-1 text-xs text-gray-500 truncate",children:e.image_name})]},e.id))})]}),("pending"===v.status||"rejected"===v.status)&&(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[m&&"admin"!==m.role&&v.applicant_id===m.id&&a.jsx(a.Fragment,{children:a.jsx("button",{onClick:()=>{let e=prompt("请输入撤销原因：");e&&j(e)},className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"撤销申请"})}),m&&"admin"===m.role&&"pending"===v.status&&(0,a.jsxs)(a.Fragment,{children:[a.jsx("button",{onClick:()=>{let e=prompt("请输入拒绝原因：");e&&y(e)},className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"拒绝"}),a.jsx("button",{onClick:b,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"批准"})]})]})]})]})}),p&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4",onClick:()=>h(null),children:(0,a.jsxs)("div",{className:"relative w-full h-full max-w-6xl max-h-[90vh] flex items-center justify-center",children:[a.jsx("img",{src:p,alt:"预览图片",className:"max-w-full max-h-full object-contain"}),a.jsx("button",{onClick:e=>{e.stopPropagation(),h(null)},className:"absolute top-4 right-4 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70",children:a.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),a.jsx("button",{onClick:e=>{e.stopPropagation(),window.open(p,"_blank")},className:"absolute top-4 right-16 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70",children:a.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})})]})})]})}function c({applications:e,loading:t,onRefresh:s,pagination:l,onPageChange:n,currentPage:i}){let[c,d]=(0,r.useState)(null),x=e=>new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),m=e=>new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(e),u=e=>{switch(e){case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"cancelled":return"bg-gray-100 text-gray-800";default:return"bg-yellow-100 text-yellow-800"}},p=e=>{switch(e){case"approved":return"已通过";case"rejected":return"已拒绝";case"cancelled":return"已撤销";default:return"待审批"}};return t?a.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:a.jsx("div",{className:"flex justify-center",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})})}):(0,a.jsxs)(a.Fragment,{children:[a.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:0===e.length?a.jsx("div",{className:"p-6 text-center text-gray-500",children:"暂无申请记录"}):a.jsx("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"时间"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"类型"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"标题"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"申请人"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"分类"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"金额"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"状态"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:x(e.created_at)}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${"income"===e.type?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:"income"===e.type?"收入":"支出"})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.title}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.applicant_name}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.category_name||"-"}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:a.jsx("span",{className:"income"===e.type?"text-green-600":"text-red-600",children:m(e.amount)})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${u(e.status)}`,children:p(e.status)})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:a.jsx("button",{onClick:()=>d(e),className:"text-blue-600 hover:text-blue-900",children:"查看详情"})})]},e.id))})]})})}),c&&a.jsx(o,{application:c,isOpen:!!c,onClose:()=>d(null),onUpdate:s}),l&&l.pages>1&&a.jsx("div",{className:"bg-white rounded-lg shadow p-4 mt-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-700",children:["显示第 ",(i||l.page-1)*l.limit+1," 到"," ",Math.min((i||l.page)*l.limit,l.total)," 条，共"," ",l.total," 条记录"]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[a.jsx("button",{onClick:()=>n&&n((i||l.page)-1),disabled:1>=(i||l.page),className:`px-3 py-1 rounded ${1>=(i||l.page)?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"上一页"}),Array.from({length:Math.min(5,l.pages)},(e,t)=>{let s;return s=l.pages<=5?t+1:3>=(i||l.page)?t+1:(i||l.page)>=l.pages-2?l.pages-4+t:(i||l.page)-2+t,a.jsx("button",{onClick:()=>n&&n(s),className:`px-3 py-1 rounded ${(i||l.page)===s?"bg-blue-600 text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:s},s)}),a.jsx("button",{onClick:()=>n&&n((i||l.page)+1),disabled:(i||l.page)>=l.pages,className:`px-3 py-1 rounded ${(i||l.page)>=l.pages?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"下一页"})]})]})})]})}function d({filters:e,onFiltersChange:t}){let[s,l]=(0,r.useState)([]),[n,i]=(0,r.useState)([]),o=(s,a)=>{t({...e,[s]:a})};return a.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"类型"}),(0,a.jsxs)("select",{value:e.type||"all",onChange:e=>o("type",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"all",children:"全部"}),a.jsx("option",{value:"income",children:"收入"}),a.jsx("option",{value:"expense",children:"支出"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"支出分类"}),(0,a.jsxs)("select",{value:e.categoryId||"",onChange:e=>o("categoryId",e.target.value?Number(e.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"",children:"全部分类"}),s.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"申请人"}),(0,a.jsxs)("select",{value:e.applicantId||"",onChange:e=>o("applicantId",e.target.value?Number(e.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"",children:"全部人员"}),n.map(e=>a.jsx("option",{value:e.id,children:e.real_name},e.id))]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"状态"}),(0,a.jsxs)("select",{value:e.status||"",onChange:e=>o("status",e.target.value||void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"",children:"全部状态"}),a.jsx("option",{value:"pending",children:"待审批"}),a.jsx("option",{value:"approved",children:"已通过"}),a.jsx("option",{value:"rejected",children:"已拒绝"}),a.jsx("option",{value:"cancelled",children:"已撤销"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"搜索"}),a.jsx("input",{type:"text",value:e.search||"",onChange:e=>o("search",e.target.value),placeholder:"搜索标题或描述...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})})}function x(){let[e,t]=(0,r.useState)(!1),s=async()=>{t(!0);try{let e=localStorage.getItem("auth-token"),t=await fetch("/api/export/xlsx",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(t.ok){let e=await t.blob(),s=window.URL.createObjectURL(e),a=document.createElement("a");a.style.display="none",a.href=s,a.download=`班费明细_${new Date().toLocaleDateString("zh-CN")}.xlsx`,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(s),document.body.removeChild(a),i.Am.success("Excel文件已下载")}else{let e=await t.text();console.error("导出失败:",e),i.Am.error(`导出失败: ${t.status}`)}}catch(e){i.Am.error("导出失败")}finally{t(!1)}},l=async()=>{t(!0);try{let e=localStorage.getItem("auth-token"),t=await fetch("/api/export/png",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(t.ok){let e=await t.blob(),s=window.URL.createObjectURL(e),a=document.createElement("a");a.style.display="none",a.href=s,a.download=`班费报表_${new Date().toLocaleDateString("zh-CN")}.html`,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(s),document.body.removeChild(a),i.Am.success("HTML文件已下载，可另存为图片")}else{let e=await t.text();console.error("导出失败:",e),i.Am.error(`导出失败: ${t.status}`)}}catch(e){i.Am.error("导出失败")}finally{t(!1)}};return(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsxs)("button",{onClick:s,disabled:e,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:[a.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"导出Excel"]}),(0,a.jsxs)("button",{onClick:l,disabled:e,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:[a.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"})}),"导出报表"]})]})}function m(){let[e,t]=(0,r.useState)([]),[s,i]=(0,r.useState)(null),[o,m]=(0,r.useState)({type:"all"}),[u,p]=(0,r.useState)(!0),[h,g]=(0,r.useState)({page:1,limit:20,total:0,pages:0}),[b,y]=(0,r.useState)(1),j=async(e=1)=>{try{let s=localStorage.getItem("auth-token"),a=new URLSearchParams;o.type&&"all"!==o.type&&a.append("type",o.type),o.categoryId&&a.append("categoryId",String(o.categoryId)),o.applicantId&&a.append("applicantId",String(o.applicantId)),o.status&&a.append("status",o.status),o.search&&a.append("search",o.search),a.append("page",String(e)),a.append("limit","20");let r=await fetch(`/api/applications?${a.toString()}`,{headers:{Authorization:`Bearer ${s}`}}),l=await r.json();l.success&&(t(l.data.applications),g(l.data.pagination),y(e))}catch(e){console.error("Failed to fetch applications:",e)}finally{p(!1)}};return a.jsx(l.Z,{children:(0,a.jsxs)("div",{className:"px-4 py-6 sm:px-0",children:[(0,a.jsxs)("div",{className:"mb-8",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"班费概览"}),a.jsx(n,{statistics:s})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4 sm:mb-0",children:"收支明细"}),a.jsx(x,{})]}),a.jsx(d,{filters:o,onFiltersChange:m})]}),a.jsx(c,{applications:e,loading:u,onRefresh:()=>j(b),pagination:h,onPageChange:j,currentPage:b})]})})}},83462:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var a=s(97247),r=s(28964),l=s(34178),n=s(72411);function i({children:e}){let[t,s]=(0,r.useState)(null),[i,o]=(0,r.useState)(!1),c=(0,l.useRouter)();return t?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[a.jsx("nav",{className:"bg-white shadow-md",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between h-16",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("button",{onClick:()=>c.push("/"),className:"text-xl font-bold text-gray-800 hover:text-gray-600",children:"班费管理系统"}),a.jsx("a",{href:"https://dashboard.pay.cubestudio.top",target:"_blank",rel:"noopener noreferrer",className:"ml-6 text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:"数据看板"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:["admin"===t.role&&a.jsx("button",{onClick:()=>c.push("/admin"),className:"text-gray-700 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:"管理后台"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>o(!i),className:"flex items-center text-gray-700 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:[a.jsx("span",{className:"mr-2",children:t.real_name}),a.jsx("span",{className:`text-xs px-2 py-1 rounded ${"admin"===t.role?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:"admin"===t.role?"管理员":"普通用户"}),a.jsx("svg",{className:"ml-2 h-4 w-4",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),i&&(0,a.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50",children:[a.jsx("button",{onClick:()=>{o(!1),(0,n.Am)("个人资料功能开发中")},className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left",children:"个人资料"}),a.jsx("button",{onClick:()=>{o(!1),c.push("/applications/new")},className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left",children:"新建申请"}),a.jsx("hr",{className:"my-1"}),a.jsx("button",{onClick:()=>{localStorage.removeItem("auth-token"),localStorage.removeItem("user"),n.Am.success("已退出登录"),c.push("/login")},className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left",children:"退出登录"})]})]})]})]})})}),a.jsx("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:e})]}):a.jsx("div",{children:"Loading..."})}},34178:(e,t,s)=>{"use strict";var a=s(25289);s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}})},54403:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o,metadata:()=>i});var a=s(72051),r=s(23750),l=s.n(r);s(67272);var n=s(10247);let i={title:"班费管理系统",description:"一个现代化的班级财务管理平台"};function o({children:e}){return a.jsx("html",{lang:"zh-CN",children:(0,a.jsxs)("body",{className:l().className,children:[e,a.jsx(n.x7,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff"},success:{duration:3e3,iconTheme:{primary:"#10b981",secondary:"#fff"}},error:{duration:5e3,iconTheme:{primary:"#ef4444",secondary:"#fff"}}}})]})})}},48646:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(45347).createProxy)(String.raw`C:\Users\Wu\Desktop\班费管理系统\app\page.tsx#default`)},67272:()=>{}};var t=require("../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[787,527],()=>s(43847));module.exports=a})();