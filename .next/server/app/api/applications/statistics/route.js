(()=>{var t={};t.id=314,t.ids=[314],t.modules={62849:t=>{function e(t){var e=Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}e.keys=()=>[],e.resolve=e,e.id=62849,t.exports=e},20399:t=>{"use strict";t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:t=>{"use strict";t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:t=>{"use strict";t.exports=require("buffer")},84770:t=>{"use strict";t.exports=require("crypto")},17702:t=>{"use strict";t.exports=require("events")},98216:t=>{"use strict";t.exports=require("net")},35816:t=>{"use strict";t.exports=require("process")},76162:t=>{"use strict";t.exports=require("stream")},74026:t=>{"use strict";t.exports=require("string_decoder")},95346:t=>{"use strict";t.exports=require("timers")},82452:t=>{"use strict";t.exports=require("tls")},17360:t=>{"use strict";t.exports=require("url")},21764:t=>{"use strict";t.exports=require("util")},71568:t=>{"use strict";t.exports=require("zlib")},3360:(t,e,s)=>{"use strict";s.r(e),s.d(e,{originalPathname:()=>E,patchFetch:()=>x,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>_,staticGenerationAsyncStorage:()=>m});var r={};s.r(r),s.d(r,{GET:()=>p});var a=s(73278),o=s(45002),i=s(54877),n=s(1035),c=s(29185),u=s(12467);async function p(t){try{let e=t.headers.get("authorization");if(!e||!e.startsWith("Bearer "))return(0,u.m)();let s=e.substring(7);if(!(0,c.WX)(s))return(0,u.m)();let r=await (0,n.IO)(`
      SELECT 
        SUM(CASE WHEN type = 'income' AND status = 'approved' THEN amount ELSE 0 END) as total_income,
        SUM(CASE WHEN type = 'expense' AND status = 'approved' THEN amount ELSE 0 END) as total_expense,
        COUNT(CASE WHEN status = 'approved' THEN 1 END) as total_transactions
      FROM applications
    `),a=await (0,n.IO)(`
      SELECT 
        c.id as category_id,
        c.name as category_name,
        COALESCE(SUM(a.amount), 0) as total_amount,
        COALESCE(COUNT(a.id), 0) as count
      FROM categories c
      LEFT JOIN applications a ON c.id = a.category_id AND a.type = 'expense' AND a.status = 'approved'
      GROUP BY c.id, c.name
      HAVING total_amount > 0
      ORDER BY total_amount DESC
    `),o=r[0],i=o.total_income||0,p=o.total_expense||0,l=o.total_transactions||0,d=a.reduce((t,e)=>t+e.total_amount,0),m=a.map(t=>({category_id:t.category_id,category_name:t.category_name,total_amount:t.total_amount,count:t.count,percentage:d>0?(t.total_amount/d*100).toFixed(2):0}));return(0,u.Xj)({total_balance:i-p,total_income:i,total_expense:p,total_transactions:l,category_stats:m},"获取统计数据成功")}catch(t){return console.error("Get statistics error:",t),(0,u.m)("获取统计数据失败")}}let l=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/applications/statistics/route",pathname:"/api/applications/statistics",filename:"route",bundlePath:"app/api/applications/statistics/route"},resolvedPagePath:"C:\\Users\\Wu\\Desktop\\班费管理系统\\app\\api\\applications\\statistics\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:_}=l,E="/api/applications/statistics/route";function x(){return(0,i.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:m})}},1035:(t,e,s)=>{"use strict";s.d(e,{IO:()=>a,PS:()=>o});let r=s(87615).createPool({host:process.env.DB_HOST||"localhost",port:Number(process.env.DB_PORT)||3306,user:process.env.DB_USER||"root",password:process.env.DB_PASSWORD||"",database:process.env.DB_NAME||"class_finance",waitForConnections:!0,connectionLimit:10,queueLimit:0});async function a(t,e){try{let[s]=await r.execute(t,e);return s}catch(t){throw console.error("Database query error:",t),t}}async function o(t){let e=await r.getConnection();try{await e.beginTransaction();let s=await t(e);return await e.commit(),s}catch(t){throw await e.rollback(),t}finally{e.release()}}},29185:(t,e,s)=>{"use strict";s.d(e,{Mi:()=>d,Oe:()=>l,RA:()=>c,WX:()=>u,c_:()=>p});var r=s(67390),a=s.n(r),o=s(63506),i=s.n(o);let n=process.env.JWT_SECRET||"your-secret-key",c=t=>a().sign({id:t.id,username:t.username,role:t.role},n,{expiresIn:"24h"}),u=t=>{try{return a().verify(t,n)}catch(t){return null}},p=async t=>i().hash(t,12),l=async(t,e)=>i().compare(t,e),d=()=>{let t="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",e="";for(let s=0;s<8;s++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}},12467:(t,e,s)=>{"use strict";s.d(e,{Py:()=>n,VR:()=>o,Xj:()=>a,aX:()=>c,m:()=>i});var r=s(71309);let a=(t,e="操作成功")=>r.NextResponse.json({success:!0,message:e,data:t},{status:200}),o=(t,e=400,s)=>r.NextResponse.json({success:!1,message:t,error:s},{status:e}),i=(t="未授权访问")=>r.NextResponse.json({success:!1,message:t},{status:401}),n=(t="无权限访问")=>r.NextResponse.json({success:!1,message:t},{status:403}),c=(t="资源未找到")=>r.NextResponse.json({success:!1,message:t},{status:404})}};var e=require("../../../../webpack-runtime.js");e.C(t);var s=t=>e(e.s=t),r=e.X(0,[787,454,615],()=>s(3360));module.exports=r})();