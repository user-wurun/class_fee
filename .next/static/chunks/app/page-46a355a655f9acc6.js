(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5600:function(e,t,a){Promise.resolve().then(a.bind(a,6518))},6518:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return m}});var s=a(7437),r=a(2265),l=a(6319);function n(e){let{statistics:t}=e,a=e=>new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(e),r=[{title:"当前余额",value:t?a(t.total_balance):"\xa50.00",bgColor:"bg-blue-500",textColor:"text-white"},{title:"总收入",value:t?a(t.total_income):"\xa50.00",bgColor:"bg-green-500",textColor:"text-white"},{title:"总支出",value:t?a(t.total_expense):"\xa50.00",bgColor:"bg-red-500",textColor:"text-white"},{title:"交易笔数",value:t?t.total_transactions:0,bgColor:"bg-purple-500",textColor:"text-white"}];return(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:r.map((e,t)=>(0,s.jsxs)("div",{className:"".concat(e.bgColor," ").concat(e.textColor," p-6 rounded-lg shadow-lg"),children:[(0,s.jsx)("div",{className:"text-sm opacity-90 mb-2",children:e.title}),(0,s.jsx)("div",{className:"text-2xl font-bold",children:e.value})]},t))})}var c=a(9064);function i(e){let t,{application:a,isOpen:l,onClose:n,onUpdate:i}=e,[o,d]=(0,r.useState)(null),[x,m]=(0,r.useState)(!1),[u,h]=(0,r.useState)(null),[p,g]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(l&&a.id){y();let e=localStorage.getItem("user");e&&h(JSON.parse(e))}},[l,a.id]);let y=async()=>{m(!0);try{let e=localStorage.getItem("auth-token"),t=await fetch("/api/applications/".concat(a.id),{headers:{Authorization:"Bearer ".concat(e)}}),s=await t.json();s.success&&d(s.data)}catch(e){c.Am.error("获取申请详情失败")}finally{m(!1)}},b=e=>new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),j=async()=>{try{let e=localStorage.getItem("auth-token"),t=await fetch("/api/applications/".concat(a.id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({status:"approved"})}),s=await t.json();s.success?(c.Am.success("申请已批准"),i(),n()):c.Am.error(s.message)}catch(e){c.Am.error("操作失败")}},f=async e=>{try{let t=localStorage.getItem("auth-token"),s=await fetch("/api/applications/".concat(a.id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({status:"rejected",rejection_reason:e})}),r=await s.json();r.success?(c.Am.success("申请已拒绝"),i(),n()):c.Am.error(r.message)}catch(e){c.Am.error("操作失败")}},v=async e=>{try{let t=localStorage.getItem("auth-token"),s=await fetch("/api/applications/".concat(a.id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({status:"cancelled",cancellation_reason:e})}),r=await s.json();r.success?(c.Am.success("申请已撤销"),i(),n()):c.Am.error(r.message)}catch(e){c.Am.error("操作失败")}},N=e=>{g(e)};if(!l)return null;let w=o||a;return(0,s.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:[(0,s.jsx)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"申请详情"}),(0,s.jsx)("button",{onClick:n,className:"text-gray-400 hover:text-gray-600",children:(0,s.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),x?(0,s.jsx)("div",{className:"flex justify-center py-8",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"类型"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:(0,s.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat("income"===w.type?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:"income"===w.type?"收入":"支出"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"状态"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:(0,s.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat((e=>{switch(e){case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"cancelled":return"bg-gray-100 text-gray-800";default:return"bg-yellow-100 text-yellow-800"}})(w.status)),children:(e=>{switch(e){case"approved":return"已通过";case"rejected":return"已拒绝";case"cancelled":return"已撤销";default:return"待审批"}})(w.status)})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"标题"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:w.title})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"金额"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-900 font-medium",children:(t=w.amount,new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(t))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"申请人"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:w.applicant_name})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"分类"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:w.category_name||"-"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"申请时间"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:b(w.created_at)})]}),w.expense_time&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"支出时间"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:b(w.expense_time)})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"描述"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:w.description})]}),"income"===w.type&&w.source&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"收入来源"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:w.source})]}),w.reason&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"income"===w.type?"收入原因":"支出原因"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:w.reason})]}),w.rejection_reason&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"拒绝原因"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:w.rejection_reason})]}),w.cancellation_reason&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"撤销原因"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-600",children:w.cancellation_reason})]}),w.proof_images&&w.proof_images.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"凭证图片"}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-4",children:w.proof_images.map(e=>(0,s.jsxs)("div",{className:"relative group cursor-pointer",onClick:()=>N(e.image_url),children:[(0,s.jsx)("img",{src:e.image_url,alt:e.image_name,className:"w-full h-48 object-cover rounded-lg"}),(0,s.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition duration-200 rounded-lg flex items-center justify-center",children:(0,s.jsx)("svg",{className:"w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition duration-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"})})}),(0,s.jsx)("p",{className:"mt-1 text-xs text-gray-500 truncate",children:e.image_name})]},e.id))})]}),("pending"===w.status||"rejected"===w.status)&&(0,s.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[u&&"admin"!==u.role&&w.applicant_id===u.id&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("button",{onClick:()=>{let e=prompt("请输入撤销原因：");e&&v(e)},className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"撤销申请"})}),u&&"admin"===u.role&&"pending"===w.status&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>{let e=prompt("请输入拒绝原因：");e&&f(e)},className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"拒绝"}),(0,s.jsx)("button",{onClick:j,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"批准"})]})]})]})]})}),p&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4",onClick:()=>g(null),children:(0,s.jsxs)("div",{className:"relative w-full h-full max-w-6xl max-h-[90vh] flex items-center justify-center",children:[(0,s.jsx)("img",{src:p,alt:"预览图片",className:"max-w-full max-h-full object-contain"}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),g(null)},className:"absolute top-4 right-4 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70",children:(0,s.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),window.open(p,"_blank")},className:"absolute top-4 right-16 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70",children:(0,s.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})})]})})]})}function o(e){let{applications:t,loading:a,onRefresh:l,pagination:n,onPageChange:c,currentPage:o}=e,[d,x]=(0,r.useState)(null),m=e=>new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),u=e=>new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(e),h=e=>{switch(e){case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"cancelled":return"bg-gray-100 text-gray-800";default:return"bg-yellow-100 text-yellow-800"}},p=e=>{switch(e){case"approved":return"已通过";case"rejected":return"已拒绝";case"cancelled":return"已撤销";default:return"待审批"}};return a?(0,s.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:0===t.length?(0,s.jsx)("div",{className:"p-6 text-center text-gray-500",children:"暂无申请记录"}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"时间"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"类型"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"标题"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"申请人"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"分类"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"金额"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"状态"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:m(e.created_at)}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat("income"===e.type?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:"income"===e.type?"收入":"支出"})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.title}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.applicant_name}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.category_name||"-"}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,s.jsx)("span",{className:"income"===e.type?"text-green-600":"text-red-600",children:u(e.amount)})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(h(e.status)),children:p(e.status)})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,s.jsx)("button",{onClick:()=>x(e),className:"text-blue-600 hover:text-blue-900",children:"查看详情"})})]},e.id))})]})})}),d&&(0,s.jsx)(i,{application:d,isOpen:!!d,onClose:()=>x(null),onUpdate:l}),n&&n.pages>1&&(0,s.jsx)("div",{className:"bg-white rounded-lg shadow p-4 mt-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-700",children:["显示第 ",(o||n.page-1)*n.limit+1," 到"," ",Math.min((o||n.page)*n.limit,n.total)," 条，共"," ",n.total," 条记录"]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("button",{onClick:()=>c&&c((o||n.page)-1),disabled:1>=(o||n.page),className:"px-3 py-1 rounded ".concat(1>=(o||n.page)?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50"),children:"上一页"}),Array.from({length:Math.min(5,n.pages)},(e,t)=>{let a;return a=n.pages<=5?t+1:3>=(o||n.page)?t+1:(o||n.page)>=n.pages-2?n.pages-4+t:(o||n.page)-2+t,(0,s.jsx)("button",{onClick:()=>c&&c(a),className:"px-3 py-1 rounded ".concat((o||n.page)===a?"bg-blue-600 text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50"),children:a},a)}),(0,s.jsx)("button",{onClick:()=>c&&c((o||n.page)+1),disabled:(o||n.page)>=n.pages,className:"px-3 py-1 rounded ".concat((o||n.page)>=n.pages?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50"),children:"下一页"})]})]})})]})}function d(e){let{filters:t,onFiltersChange:a}=e,[l,n]=(0,r.useState)([]),[c,i]=(0,r.useState)([]);(0,r.useEffect)(()=>{let e=async()=>{try{let e=localStorage.getItem("auth-token"),t=await fetch("/api/admin/users",{headers:{Authorization:"Bearer ".concat(e)}}),a=await t.json();a.success&&i(a.data)}catch(e){console.error("Failed to fetch users:",e)}};(async()=>{try{let e=localStorage.getItem("auth-token"),t=await fetch("/api/admin/categories",{headers:{Authorization:"Bearer ".concat(e)}}),a=await t.json();a.success&&n(a.data)}catch(e){console.error("Failed to fetch categories:",e)}})(),e()},[]);let o=(e,s)=>{a({...t,[e]:s})};return(0,s.jsx)("div",{className:"bg-white p-4 rounded-lg shadow",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"类型"}),(0,s.jsxs)("select",{value:t.type||"all",onChange:e=>o("type",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"all",children:"全部"}),(0,s.jsx)("option",{value:"income",children:"收入"}),(0,s.jsx)("option",{value:"expense",children:"支出"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"支出分类"}),(0,s.jsxs)("select",{value:t.categoryId||"",onChange:e=>o("categoryId",e.target.value?Number(e.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"",children:"全部分类"}),l.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"申请人"}),(0,s.jsxs)("select",{value:t.applicantId||"",onChange:e=>o("applicantId",e.target.value?Number(e.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"",children:"全部人员"}),c.map(e=>(0,s.jsx)("option",{value:e.id,children:e.real_name},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"状态"}),(0,s.jsxs)("select",{value:t.status||"",onChange:e=>o("status",e.target.value||void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"",children:"全部状态"}),(0,s.jsx)("option",{value:"pending",children:"待审批"}),(0,s.jsx)("option",{value:"approved",children:"已通过"}),(0,s.jsx)("option",{value:"rejected",children:"已拒绝"}),(0,s.jsx)("option",{value:"cancelled",children:"已撤销"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"搜索"}),(0,s.jsx)("input",{type:"text",value:t.search||"",onChange:e=>o("search",e.target.value),placeholder:"搜索标题或描述...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})})}function x(){let[e,t]=(0,r.useState)(!1),a=async()=>{t(!0);try{let e=localStorage.getItem("auth-token"),t=await fetch("/api/export/xlsx",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.blob(),a=window.URL.createObjectURL(e),s=document.createElement("a");s.style.display="none",s.href=a,s.download="班费明细_".concat(new Date().toLocaleDateString("zh-CN"),".xlsx"),document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(a),document.body.removeChild(s),c.Am.success("Excel文件已下载")}else{let e=await t.text();console.error("导出失败:",e),c.Am.error("导出失败: ".concat(t.status))}}catch(e){c.Am.error("导出失败")}finally{t(!1)}},l=async()=>{t(!0);try{let e=localStorage.getItem("auth-token"),t=await fetch("/api/export/png",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.blob(),a=window.URL.createObjectURL(e),s=document.createElement("a");s.style.display="none",s.href=a,s.download="班费报表_".concat(new Date().toLocaleDateString("zh-CN"),".html"),document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(a),document.body.removeChild(s),c.Am.success("HTML文件已下载，可另存为图片")}else{let e=await t.text();console.error("导出失败:",e),c.Am.error("导出失败: ".concat(t.status))}}catch(e){c.Am.error("导出失败")}finally{t(!1)}};return(0,s.jsxs)("div",{className:"flex space-x-3",children:[(0,s.jsxs)("button",{onClick:a,disabled:e,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:[(0,s.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"导出Excel"]}),(0,s.jsxs)("button",{onClick:l,disabled:e,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:[(0,s.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"})}),"导出报表"]})]})}function m(){let[e,t]=(0,r.useState)([]),[a,c]=(0,r.useState)(null),[i,m]=(0,r.useState)({type:"all"}),[u,h]=(0,r.useState)(!0),[p,g]=(0,r.useState)({page:1,limit:20,total:0,pages:0}),[y,b]=(0,r.useState)(1),j=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{let a=localStorage.getItem("auth-token"),s=new URLSearchParams;i.type&&"all"!==i.type&&s.append("type",i.type),i.categoryId&&s.append("categoryId",String(i.categoryId)),i.applicantId&&s.append("applicantId",String(i.applicantId)),i.status&&s.append("status",i.status),i.search&&s.append("search",i.search),s.append("page",String(e)),s.append("limit","20");let r=await fetch("/api/applications?".concat(s.toString()),{headers:{Authorization:"Bearer ".concat(a)}}),l=await r.json();l.success&&(t(l.data.applications),g(l.data.pagination),b(e))}catch(e){console.error("Failed to fetch applications:",e)}finally{h(!1)}},f=async()=>{try{let e=localStorage.getItem("auth-token"),t=await fetch("/api/applications/statistics",{headers:{Authorization:"Bearer ".concat(e)}}),a=await t.json();a.success&&c(a.data)}catch(e){console.error("Failed to fetch statistics:",e)}};return(0,r.useEffect)(()=>{j(1),f()},[i]),(0,s.jsx)(l.Z,{children:(0,s.jsxs)("div",{className:"px-4 py-6 sm:px-0",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"班费概览"}),(0,s.jsx)(n,{statistics:a})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4 sm:mb-0",children:"收支明细"}),(0,s.jsx)(x,{})]}),(0,s.jsx)(d,{filters:i,onFiltersChange:m})]}),(0,s.jsx)(o,{applications:e,loading:u,onRefresh:()=>j(y),pagination:p,onPageChange:j,currentPage:y})]})})}},6319:function(e,t,a){"use strict";a.d(t,{Z:function(){return c}});var s=a(7437),r=a(2265),l=a(9376),n=a(9064);function c(e){let{children:t}=e,[a,c]=(0,r.useState)(null),[i,o]=(0,r.useState)(!1),d=(0,l.useRouter)();return((0,r.useEffect)(()=>{(()=>{let e=localStorage.getItem("auth-token"),t=localStorage.getItem("user");if(console.log("检查认证状态:",{hasToken:!!e,hasUser:!!t,currentPath:window.location.pathname}),!e||!t){console.log("未找到认证信息，跳转到登录页"),d.push("/login");return}try{let e=JSON.parse(t);console.log("用户数据解析成功:",e),c(e)}catch(e){console.error("用户数据解析失败:",e),localStorage.removeItem("auth-token"),localStorage.removeItem("user"),d.push("/login")}})()},[d]),a)?(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("nav",{className:"bg-white shadow-md",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between h-16",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("button",{onClick:()=>d.push("/"),className:"text-xl font-bold text-gray-800 hover:text-gray-600",children:"班费管理系统"}),(0,s.jsx)("a",{href:"https://dashboard.pay.cubestudio.top",target:"_blank",rel:"noopener noreferrer",className:"ml-6 text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:"数据看板"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:["admin"===a.role&&(0,s.jsx)("button",{onClick:()=>d.push("/admin"),className:"text-gray-700 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:"管理后台"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("button",{onClick:()=>o(!i),className:"flex items-center text-gray-700 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:[(0,s.jsx)("span",{className:"mr-2",children:a.real_name}),(0,s.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat("admin"===a.role?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"),children:"admin"===a.role?"管理员":"普通用户"}),(0,s.jsx)("svg",{className:"ml-2 h-4 w-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),i&&(0,s.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50",children:[(0,s.jsx)("button",{onClick:()=>{o(!1),(0,n.Am)("个人资料功能开发中")},className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left",children:"个人资料"}),(0,s.jsx)("button",{onClick:()=>{o(!1),d.push("/applications/new")},className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left",children:"新建申请"}),(0,s.jsx)("hr",{className:"my-1"}),(0,s.jsx)("button",{onClick:()=>{localStorage.removeItem("auth-token"),localStorage.removeItem("user"),n.Am.success("已退出登录"),d.push("/login")},className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left",children:"退出登录"})]})]})]})]})})}),(0,s.jsx)("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:t})]}):(0,s.jsx)("div",{children:"Loading..."})}},9376:function(e,t,a){"use strict";var s=a(5475);a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}})}},function(e){e.O(0,[64,971,117,744],function(){return e(e.s=5600)}),_N_E=e.O()}]);